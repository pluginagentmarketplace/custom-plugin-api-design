# Scaling Configuration Template
# Enterprise patterns for distributed systems

version: "1.0.0"

# Microservices Architecture
microservices:
  communication:
    sync:
      protocol: "REST"  # REST | gRPC
      timeout_ms: 30000
      retry_count: 3

    async:
      broker: "rabbitmq"  # rabbitmq | kafka | redis
      queue_prefix: "app."

  discovery:
    type: "kubernetes"  # kubernetes | consul | eureka

  load_balancing:
    algorithm: "round_robin"  # round_robin | least_connections | ip_hash

# Event Sourcing
event_sourcing:
  enabled: true

  store:
    type: "postgresql"  # postgresql | eventstore | mongodb
    table: "events"

  snapshots:
    enabled: true
    frequency: 100  # Every 100 events

  projections:
    - name: "orders_summary"
      events: ["OrderCreated", "OrderCompleted"]
    - name: "user_activity"
      events: ["UserLoggedIn", "UserUpdated"]

# CQRS
cqrs:
  enabled: true

  write_model:
    database: "postgresql"
    consistency: "strong"

  read_model:
    database: "elasticsearch"
    consistency: "eventual"
    sync_delay_ms: 100

# SAGA Pattern
saga:
  orchestration:
    enabled: true
    timeout_ms: 60000

  compensation:
    max_retries: 3
    backoff_ms: 1000

  steps:
    order_saga:
      - name: create_order
        compensation: cancel_order
      - name: reserve_inventory
        compensation: release_inventory
      - name: process_payment
        compensation: refund_payment
      - name: create_shipment
        compensation: cancel_shipment

# Circuit Breaker
circuit_breaker:
  failure_threshold: 5
  success_threshold: 3
  timeout_ms: 60000

  states:
    closed:
      description: "Normal operation"
    open:
      description: "Failing, reject requests"
    half_open:
      description: "Testing recovery"

# Bulkhead Pattern
bulkhead:
  enabled: true

  pools:
    database:
      max_concurrent: 10
      queue_size: 100
    external_api:
      max_concurrent: 5
      queue_size: 50

# Message Queue
message_queue:
  provider: "rabbitmq"

  exchanges:
    - name: "events"
      type: "topic"
      durable: true
    - name: "commands"
      type: "direct"
      durable: true

  queues:
    - name: "order.created"
      durable: true
      dead_letter: true
    - name: "payment.process"
      durable: true
      prefetch: 10

  retry:
    max_attempts: 5
    backoff: "exponential"
    initial_delay_ms: 1000
    max_delay_ms: 60000

# Rate Limiting
rate_limiting:
  distributed: true
  store: "redis"

  tiers:
    free:
      requests_per_minute: 60
    standard:
      requests_per_minute: 600
    enterprise:
      requests_per_minute: 6000

# Caching
distributed_cache:
  provider: "redis"

  clusters:
    - name: "session"
      nodes: 3
      ttl: 86400
    - name: "api"
      nodes: 3
      ttl: 300

  strategies:
    - cache_aside
    - write_through

# AI Agent Integration
ai_agents:
  enabled: true

  providers:
    anthropic:
      model: "claude-3-5-sonnet-20241022"
      max_tokens: 4096
      temperature: 0.7

  tools:
    - name: "search_database"
      description: "Search the database"
    - name: "send_notification"
      description: "Send user notification"

  rate_limiting:
    requests_per_minute: 100
    tokens_per_minute: 100000

# Monitoring
monitoring:
  distributed_tracing:
    enabled: true
    provider: "jaeger"
    sample_rate: 0.1

  metrics:
    enabled: true
    provider: "prometheus"

  logging:
    centralized: true
    provider: "elasticsearch"

# Disaster Recovery
disaster_recovery:
  backup:
    frequency: "hourly"
    retention_days: 30
    cross_region: true

  failover:
    automatic: true
    health_check_interval_ms: 10000
    unhealthy_threshold: 3

  regions:
    primary: "us-east-1"
    secondary: "us-west-2"
